<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ site }} | {{ college }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg-1: #0b1020; --bg-2: #071225;
            --neon-a: #00ffd5; --neon-b: #6b8cff; --neon-c: #ff4d94;
            --muted: rgba(255,255,255,0.06);
        }
        html,body{height:100%;margin:0;font-family:Inter,Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#e6f7ff;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));-webkit-font-smoothing:antialiased}
        /* full-screen ambient neon dots */
        body::after{content:'';position:fixed;inset:0;background-image:radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);background-size:80px 80px;opacity:0.6;mix-blend-mode:overlay;pointer-events:none}
        .container{
            width:clamp(480px,85%,1100px);margin:6vh auto;border-radius:18px;padding:34px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));box-shadow: 0 30px 80px rgba(2,6,23,0.7), inset 0 1px 0 rgba(255,255,255,0.02);position:relative;overflow:visible;backdrop-filter: blur(6px);
            transform-style: preserve-3d; transition: transform .18s ease-out;
        }
        /* subtle neon watermark */
        .container::before{content:'';position:absolute;right:-30px;top:-20px;width:420px;height:420px;background-image:url('/static/logo.png');background-repeat:no-repeat;background-size:contain;background-position:center;opacity:0.06;filter:brightness(2) hue-rotate(10deg);transform:translateZ(-50px);pointer-events:none}
        h1{font-size:3.2rem;margin:0 0 6px;color:var(--neon-a);font-weight:900;letter-spacing:0.6px;text-shadow:0 2px 18px rgba(0,255,213,0.14),0 0 18px rgba(107,140,255,0.06)}
        h2{margin:6px 0 20px;font-weight:700;color:#cfefff;opacity:0.9}
        .hero{display:flex;gap:22px;align-items:stretch;justify-content:space-between}
        .left{flex:1;min-width:380px}
        .right{width:360px;min-width:260px}
        .lead{color:#bfeeff;opacity:0.88;max-width:60ch;line-height:1.6}
        .controls{display:flex;flex-direction:column;gap:12px}
    .btn{position:relative;display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:12px 20px;border-radius:12px;border:0;font-weight:800;color:#071225;background:linear-gradient(90deg,var(--neon-b),var(--neon-a));cursor:pointer;overflow:hidden;box-shadow:0 10px 40px rgba(2,6,23,0.7),0 0 28px rgba(107,140,255,0.06);transition:transform .18s cubic-bezier(.2,.8,.2,1),box-shadow .18s}
    .btn::before{content:'';position:absolute;inset:0;border-radius:12px;padding:1px;filter:blur(10px);opacity:0.9;background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.01));mix-blend-mode:screen;pointer-events:none}
    .btn::after{content:'';position:absolute;left:-60%;top:0;width:60%;height:100%;background:linear-gradient(120deg, rgba(255,255,255,0.12), rgba(255,255,255,0.02), rgba(255,255,255,0));transform:skewX(-18deg);opacity:0.7;transition:all .6s ease}
    .btn > *{position:relative;z-index:1}
    .btn:hover{transform:translateY(-6px) scale(1.02);box-shadow:0 22px 88px rgba(2,6,23,0.7),0 0 48px rgba(107,140,255,0.12)}
    .btn:active{transform:translateY(-2px) scale(.998)}
    .btn:focus{outline:none;box-shadow:0 0 0 6px rgba(107,140,255,0.06)}
    .btn:hover::after{left:120%;opacity:0}
    .btn.neon{background:linear-gradient(90deg, rgba(10,10,12,0.4), rgba(255,255,255,0.02));color:#eaffff;border-left:4px solid rgba(255,255,255,0.06)}
    
        /* ripple effect */
        .btn .ripple{position:absolute;border-radius:50%;transform:scale(0);pointer-events:none;opacity:0.9;background:rgba(255,255,255,0.14);animation:ripple 650ms cubic-bezier(.2,.7,.2,1);}
        @keyframes ripple{to{transform:scale(8);opacity:0;}}
        .btn.admin{box-shadow:0 8px 30px rgba(107,140,255,0.06), 0 8px 38px rgba(0,255,213,0.03);border-left:4px solid var(--neon-b)}
        .btn.student{box-shadow:0 8px 30px rgba(255,77,148,0.04);border-left:4px solid var(--neon-c)}
        .btn:active{transform:translateY(1px)}
        .neon-glow{position:absolute;left:50%;top:-30px;transform:translateX(-50%);width:60%;height:160px;pointer-events:none;filter:blur(40px);opacity:0.22;background:radial-gradient(circle at 20% 30%, rgba(107,140,255,0.6), transparent 12%), radial-gradient(circle at 80% 70%, rgba(0,255,213,0.6), transparent 12%)}
        /* animated 3D tilt */
        .tilt-root{transform-style:preserve-3d;transition:transform .12s ease}
        .card-3d{transform: translateZ(0); will-change: transform}
        /* attendance table area hidden on home page per request */
        #attendance-view{display:none}
        @media (max-width:820px){.hero{flex-direction:column}.right{width:100%}}
    </style>
</head>
<body>
    <div class="container">
        <div style="display:flex;align-items:stretch;gap:18px;flex-wrap:wrap;justify-content:space-between">
            <div style="flex:1;min-width:320px;display:flex;flex-direction:column;justify-content:center;gap:10px;padding:18px">
                <h1>{{ site }}</h1>
                <h2>Attendance Management ‚Äî {{ college }}</h2>
                <p class="lead">Real-time multi-face attendance ‚Äî monitor live CCTV feeds, approve student registrations (from the admin panel), and export attendance. Use Admin Login to manage registrations and student records. </p>
                <div style="margin-top:18px;position:relative;">
                    <div class="neon-glow" aria-hidden="true"></div>
                </div>
            </div>

            <div class="right tilt-root">
                <div class="card-3d" style="padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02);backdrop-filter:blur(6px)">
                    <div style="display:flex;flex-direction:column;gap:12px;align-items:stretch">
                        <button id="open-admin" class="btn neon admin" style="padding:14px;">üîê Admin Login</button>
                        <button id="open-student" class="btn neon student" style="padding:14px;">üéì Student Login</button>
                        <!-- Register moved to Admin Panel per request -->
                        <div style="color:#8fbfe6;font-weight:700;padding:8px;margin-top:6px;border-radius:8px;font-size:0.95rem;background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.006));border:1px solid rgba(255,255,255,0.02);">Register Student is available in the Admin panel only.</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- attendance-view intentionally hidden on home screen per request -->
        <div id="attendance-view" style="margin-top:18px;display:none;" class="card-anim"></div>
    </div>
    <script>
        // Attendance loading removed from home screen (handled via admin panel)
        function loadAttendance(){ showToast('Open Admin panel to view attendance','info'); }
    </script>
    <!-- Particle background canvas and modals -->
    <canvas id="bg-canvas" style="position:fixed;left:0;top:0;right:0;bottom:0;z-index:-1;mix-blend-mode:screen;" aria-hidden="true"></canvas>

    <!-- Toast container -->
    <div id="toasts" style="position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:8px;z-index:10000"></div>

    <!-- Admin Modal -->
    <div id="modal-overlay" style="display:none;position:fixed;inset:0;background:rgba(4,12,18,0.45);backdrop-filter:blur(4px);align-items:center;justify-content:center;z-index:1000">
        <div id="modal" style="width:420px;max-width:94%;background:linear-gradient(180deg,rgba(255,255,255,0.98),#fff);padding:18px;border-radius:12px;box-shadow:0 24px 80px rgba(8,30,40,0.36)">
            <button id="modal-close" style="float:right;background:none;border:0;font-size:18px;cursor:pointer">‚úñ</button>
            <h3 id="modal-title" style="margin-top:2px;color:#16384a">Login</h3>
            <form id="modal-form" method="post" action="/login">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
                    <input id="m-username" name="username" placeholder="username" style="padding:10px;border-radius:8px;border:1px solid #e6eef2;"> 
                    <input id="m-password" name="password" type="password" placeholder="password" style="padding:10px;border-radius:8px;border:1px solid #e6eef2;">
                    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
                        <button class="btn" id="modal-submit" type="submit">Login</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
    // Simple toast helper
        function showToast(msg, type='info', timeout=3500){
            const el = document.createElement('div');
            el.style.padding='10px 14px'; el.style.borderRadius='10px'; el.style.minWidth='180px'; el.style.boxShadow='0 8px 24px rgba(0,0,0,0.12)';
            el.style.background = type==='error' ? 'linear-gradient(90deg,#ff6b6b,#ff4757)' : (type==='success' ? 'linear-gradient(90deg,#7ee8fa,#80ff72)' : 'linear-gradient(90deg,#6dd5ed,#2193b0)');
            el.style.color='#012'; el.style.fontWeight='700'; el.innerText = msg;
            document.getElementById('toasts').appendChild(el);
            setTimeout(()=>{ el.style.transition='opacity .4s,transform .4s'; el.style.opacity=0; el.style.transform='translateY(10px)'; setTimeout(()=>el.remove(),450); }, timeout);
        }

        // Modal behavior
        const overlay = document.getElementById('modal-overlay');
        const modal = document.getElementById('modal');
        document.getElementById('open-admin').addEventListener('click', ()=>{
            document.getElementById('modal-title').innerText='Admin Login';
            document.getElementById('modal-form').action='/login';
            overlay.style.display='flex'; document.getElementById('m-username').focus();
        });
        document.getElementById('open-student').addEventListener('click', ()=>{
            document.getElementById('modal-title').innerText='Student Login';
            document.getElementById('modal-form').action='/student_login';
            overlay.style.display='flex'; document.getElementById('m-username').focus();
        });
        document.getElementById('modal-close').addEventListener('click', ()=> overlay.style.display='none');
        overlay.addEventListener('click', (e)=>{ if(e.target===overlay) overlay.style.display='none'; });

        // Inline validation and AJAX submission for modal form
        document.getElementById('modal-form').addEventListener('submit', async function(e){
            e.preventDefault();
            const form = e.target;
            const data = new FormData(form);
            const username = data.get('username');
            const password = data.get('password');
            if(!username || !password){ showToast('Please enter username and password','error'); return; }
            try{
                const res = await fetch(form.action, { method:'POST', body: data, headers: {'X-Requested-With':'XMLHttpRequest'} });
                const j = await res.json().catch(()=>null);
                if(res.ok && j && j.ok){
                    showToast('Login successful','success');
                    overlay.style.display='none';
                    setTimeout(()=>location.href = (j.redirect || '/'), 450);
                } else if(j && j.error){
                    showToast(j.error,'error');
                } else {
                    showToast('Login failed','error');
                }
            }catch(err){ showToast('Network error','error'); }
        });

        // keyboard accessibility: allow Enter to submit and Space to activate focused buttons
        document.addEventListener('keydown', function(e){
            const active = document.activeElement;
            if(!active) return;
            // Enter: submit if inside form
            if(e.key === 'Enter'){
                const f = active.closest && active.closest('form');
                if(f){ e.preventDefault(); f.requestSubmit?.() || f.submit(); }
            }
            // Space: activate button
            if(e.key === ' ' || e.key === 'Spacebar'){
                if(active.classList && active.classList.contains('btn')){ e.preventDefault(); active.click(); }
            }
        });

        // Focus trap for accessibility
        (function(){
            let lastFocused = null;
            const focusable = 'a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])';
            document.addEventListener('focusin', (e)=>{ lastFocused = e.target; });
            overlay.addEventListener('keydown',(e)=>{
                if(e.key==='Tab'){
                    const nodes = Array.from(modal.querySelectorAll(focusable)).filter(n=>!n.disabled && n.offsetParent !== null);
                    if(nodes.length===0) return;
                    const first = nodes[0], last = nodes[nodes.length-1];
                    if(e.shiftKey && document.activeElement===first){ e.preventDefault(); last.focus(); }
                    else if(!e.shiftKey && document.activeElement===last){ e.preventDefault(); first.focus(); }
                } else if(e.key==='Escape'){
                    overlay.style.display='none';
                }
            });
        })();

        // Password visibility toggle
        (function(){
            const pwd = document.getElementById('m-password');
            const btn = document.createElement('button'); btn.type='button'; btn.innerText='üëÅÔ∏è'; btn.style.marginLeft='6px'; btn.style.padding='6px'; btn.style.border='none'; btn.style.background='transparent';
            btn.addEventListener('click', ()=>{ if(pwd.type==='password'){ pwd.type='text'; btn.innerText='üôà' } else { pwd.type='password'; btn.innerText='üëÅÔ∏è' } });
            pwd.parentNode.insertBefore(btn, pwd.nextSibling);
        })();

        // Particle background (simple)
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let w=canvas.width=innerWidth, h=canvas.height=innerHeight; window.addEventListener('resize', ()=>{ w=canvas.width=innerWidth; h=canvas.height=innerHeight; });
        const pts = [];
        for(let i=0;i<160;i++) pts.push({x:Math.random()*w,y:Math.random()*h, vx:(Math.random()-0.5)*1.2, vy:(Math.random()-0.5)*1.2, r:Math.random()*2.6+0.6, hue: 160 + Math.random()*120});
        function step(){ ctx.clearRect(0,0,w,h); for(let p of pts){ p.x+=p.vx; p.y+=p.vy; if(p.x< -20) p.x = w+20; if(p.x> w+20) p.x=-20; if(p.y< -20) p.y = h+20; if(p.y> h+20) p.y=-20; ctx.beginPath(); ctx.fillStyle=`rgba(\${p.hue},\${p.hue},\${p.hue},0.06)`; // fallback
                // multi-colored neon dots
                const g = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*6);
                g.addColorStop(0, `hsla(${p.hue},90%,60%,0.18)`);
                g.addColorStop(0.6, `hsla(${p.hue},80%,50%,0.08)`);
                g.addColorStop(1, 'transparent');
                ctx.fillStyle = g;
                ctx.fillRect(p.x-p.r*6,p.y-p.r*6,p.r*12,p.r*12);
        }
            requestAnimationFrame(step);
        }
        step();

        // 3D tilt for right card
        const tiltRoot = document.querySelector('.tilt-root');
        if(tiltRoot){
            const bounds = () => tiltRoot.getBoundingClientRect();
            tiltRoot.addEventListener('mousemove', (ev)=>{
                const b = bounds();
                const cx = b.left + b.width/2; const cy = b.top + b.height/2;
                const dx = ev.clientX - cx; const dy = ev.clientY - cy;
                const rx = (-dy / b.height) * 10; const ry = (dx / b.width) * 10;
                tiltRoot.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) translateZ(6px)`;
            });
            tiltRoot.addEventListener('mouseleave', ()=>{ tiltRoot.style.transform='none'; });
        }
        // ripple click handler (delegated)
        document.addEventListener('click', function(e){
            const btn = e.target.closest('.btn');
            if(!btn) return;
            // create ripple node
            const r = document.createElement('span'); r.className='ripple';
            const rect = btn.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            r.style.width = r.style.height = size+'px';
            const x = e.clientX - rect.left - size/2; const y = e.clientY - rect.top - size/2;
            r.style.left = x+'px'; r.style.top = y+'px';
            btn.appendChild(r);
            setTimeout(()=> r.remove(), 700);
        });
    </script>
</body>
</html>
